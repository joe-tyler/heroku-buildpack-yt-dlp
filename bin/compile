#!/usr/bin/env bash

header() {
  echo "" || true
  echo "-----> $*" || true
}

output() {
  while IFS= read -r LINE; do
    # do not indent headers that are being piped through the output
    if [[ "$LINE" =~ ^-----\>.* ]]; then
      echo "$LINE" || true
    else
      echo "       $LINE" || true
    fi
  done
}
set -eo pipefail
BUILD_DIR=${1:-}
cd $BUILD_DIR
mkdir -p vendor/yt
cd vendor/yt
curl --location https://github.com/yt-dlp/yt-dlp/releases/download/2023.12.30/yt-dlp -o yt-dlp
echo '91c667e0521951198e0fe348cad30b8f9c6b9b74  yt-dlp' > yt-dlp.sha
sha1sum --check yt-dlp.sha
chmod a+rx yt-dlp
./yt-dlp --version
PROFILE_PATH="$BUILD_DIR/.profile.d/yt-dlp.sh"
mkdir -p $(dirname $PROFILE_PATH)
echo 'export PATH="$PATH:${HOME}/vendor/yt"' >> $PROFILE_PATH
echo "Finished installing yt-dlp" | output
